<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reichweiten-Analyse | EV Technical Insights</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        /* Basis-Styles (identisch zu den anderen Seiten fÃ¼r Konsistenz) */
        :root{--navy:#002B5B;--cyan:#00F2FF;--surface:#F9FAFB;--anthracite:#1F2937;}
        body{font-family:'Inter',sans-serif;background:var(--surface);color:var(--anthracite);margin:0;padding:0;}
        .container{max-width:1280px;margin:0 auto;padding:0 24px;}
        
        /* Header & Nav (Kopie von Dashboard) */
        .header{background:var(--navy);color:white;position:sticky;top:0;z-index:1000;}
        .header-main{display:flex;justify-content:space-between;align-items:center;padding:16px 0;}
        .nav-links{display:flex;list-style:none;gap:24px;}
        .nav-links a{color:rgba(255,255,255,0.8);text-decoration:none;font-weight:500;}
        .nav-links a.active{color:var(--cyan);font-weight:700;}
        
        .page-header{background:linear-gradient(135deg,var(--navy),#001a38);color:white;padding:60px 0;}
        h1{font-size:36px;margin-bottom:10px;}
        
        /* Charts Area */
        .chart-section{padding:60px 0;}
        .chart-container{background:white;border-radius:16px;padding:24px;border:1px solid #E5E7EB;margin-bottom:40px;height:400px;}
        
        /* Top List Style */
        .ranking-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;}
        .rank-card{background:white;padding:24px;border-radius:12px;border-left:4px solid var(--navy);box-shadow:0 4px 6px rgba(0,0,0,0.05);}
        .rank-card.winner{border-left-color:var(--cyan);}
        .rank-value{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:bold;color:var(--navy);}
        .rank-label{font-size:14px;color:#666;margin-bottom:8px;}
        
        /* Mobile Menu */
        .mobile-menu-btn{display:none;background:none;border:none;color:white;font-size:24px;}
        @media(max-width:768px){.nav-links{display:none}.mobile-menu-btn{display:block}}
    </style>
</head>
<body>

    <header class="header"><div class="container"><div class="header-main">
        <div style="font-weight:800;font-size:20px;">EV Technical <span style="color:var(--cyan)">Insights</span></div>
        <ul class="nav-links">
            <li><a href="dashboard.html">ğŸ“Š Dashboard</a></li>
            <li><a href="fahrzeuge.html">ğŸ”‹ Fahrzeuge</a></li>
            <li><a href="news.html">ğŸ“° News</a></li>
            <li><a href="laden.html">âš¡ Preise</a></li>
            <li><a href="ratgeber.html">ğŸ“‹ Ratgeber</a></li>
            <li><a href="reichweite.html" class="active">ğŸ“ Analyse</a></li>
        </ul>
        <button class="mobile-menu-btn">â˜°</button>
    </div></div></header>

    <section class="page-header"><div class="container">
        <h1>ğŸ“ Reichweiten-Analyse</h1>
        <p>Daten statt Angst: Wie weit kommen E-Autos wirklich und wohin geht der Trend?</p>
    </div></section>

    <section class="chart-section"><div class="container">
        
        <h2>ğŸ’° Preis-Leistungs-Matrix</h2>
        <p style="margin-bottom:20px; color:#666;">Welches Auto bietet die meiste Reichweite fÃ¼rs Geld? Autos oben links sind die "Preis-Leistungs-Sieger".</p>
        <div class="chart-container">
            <canvas id="scatterChart"></canvas>
        </div>

        <h2 style="margin-top:60px;">ğŸ† Die "Reichweiten-KÃ¶nige" (Preis pro km)</h2>
        <div class="ranking-grid" id="efficiency-grid">
            </div>

        <h2 style="margin-top:60px;">ğŸ“ˆ Die Reichweiten-Evolution (2014 - 2026)</h2>
        <p style="margin-bottom:20px; color:#666;">Der technologische Fortschritt im historischen Vergleich.</p>
        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>

    </div></section>

    <script>
        // Datenquellen
        const FILES = {
            fahrzeuge: './data/fahrzeuge.csv',
            trends: './data/range_trends.csv'
        };

        async function init() {
            const [fahrzeuge, trends] = await Promise.all([
                loadCSV(FILES.fahrzeuge),
                loadCSV(FILES.trends)
            ]);

            renderScatterChart(fahrzeuge);
            renderEfficiencyRank(fahrzeuge);
            
            // Falls Trend-Daten existieren (du musst die CSV erst erstellen), zeige sie an
            if(trends.length > 0) renderTrendChart(trends);
        }

        // 1. Scatter Chart: Preis vs Reichweite
        function renderScatterChart(data) {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            
            // Daten aufbereiten: Wir wollen {x: Preis, y: Reichweite, label: Modell}
            const points = data.map(v => ({
                x: v.preis_chf,
                y: v.reichweite_wltp,
                model: `${v.marke} ${v.modell}`
            }));

            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Fahrzeuge',
                        data: points,
                        backgroundColor: '#00F2FF',
                        borderColor: '#002B5B',
                        borderWidth: 1,
                        pointRadius: 6,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.raw.model}: ${ctx.raw.y}km fÃ¼r CHF ${ctx.raw.x.toLocaleString()}`
                            }
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Preis (CHF)' }, min: 20000 },
                        y: { title: { display: true, text: 'Reichweite (WLTP km)' }, min: 200 }
                    }
                }
            });
        }

        // 2. Ranking: Preis pro km Reichweite
        function renderEfficiencyRank(data) {
            // Berechne "CHF pro km"
            const ranked = data.map(v => ({
                ...v,
                costPerKm: Math.round(v.preis_chf / v.reichweite_wltp)
            })).sort((a, b) => a.costPerKm - b.costPerKm).slice(0, 3); // Top 3

            const grid = document.getElementById('efficiency-grid');
            grid.innerHTML = ranked.map((v, i) => `
                <div class="rank-card ${i===0?'winner':''}">
                    <div class="rank-label">Platz #${i+1}</div>
                    <h3>${v.marke} ${v.modell}</h3>
                    <div class="rank-value">CHF ${v.costPerKm} / km</div>
                    <p style="font-size:12px; margin-top:5px;">${v.reichweite_wltp} km fÃ¼r CHF ${v.preis_chf.toLocaleString()}</p>
                </div>
            `).join('');
        }

        // 3. Trend Chart
        function renderTrendChart(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Sortieren nach Jahr
            data.sort((a,b) => a.jahr - b.jahr);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.jahr),
                    datasets: [{
                        label: 'Max. Reichweite (km)',
                        data: data.map(d => d.reichweite),
                        borderColor: '#002B5B',
                        backgroundColor: 'rgba(0, 242, 255, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: (ctx) => data[ctx.dataIndex].modell // Zeigt Modellnamen beim Hover
                            }
                        }
                    }
                }
            });
        }

        function loadCSV(url) {
            return new Promise(resolve => {
                Papa.parse(url, {
                    download: true, header: true, dynamicTyping: true, skipEmptyLines: true,
                    complete: res => resolve(res.data),
                    error: () => resolve([]) // Fehler ignorieren, leeres Array zurÃ¼ck
                });
            });
        }

        init();
    </script>
</body>
</html>
