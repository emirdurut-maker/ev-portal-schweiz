<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="EV Markt-Dashboard Schweiz: Live-Statistiken zu Elektroauto-Zulassungen, Marktanteilen und Trends. Monatlich aktualisierte Daten.">
    <meta name="keywords" content="Elektroauto Statistik Schweiz, EV Marktanteil, Zulassungszahlen, BEV PHEV, Tesla Schweiz, Elektromobilit√§t Daten">
    <meta name="author" content="EV Technical Insights">
    <meta name="robots" content="index, follow">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://emirdurut-maker.github.io/ev-portal-schweiz/dashboard.html">
    <meta property="og:title" content="EV Markt-Dashboard Schweiz | EV Technical Insights">
    <meta property="og:description" content="Live-Statistiken zu Elektroauto-Zulassungen, Marktanteilen und Trends in der Schweiz.">
    <meta property="og:image" content="https://emirdurut-maker.github.io/ev-portal-schweiz/og-image.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="EV Markt-Dashboard Schweiz">
    <meta name="twitter:description" content="Live-Statistiken zur Elektromobilit√§t in der Schweiz.">
    
    <link rel="canonical" href="https://emirdurut-maker.github.io/ev-portal-schweiz/dashboard.html">
    
    <title>Markt-Dashboard | EV Technical Insights</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--navy:#002B5B;--navy-dark:#001a38;--cyan:#00F2FF;--cyan-dim:rgba(0,242,255,0.15);--surface:#F9FAFB;--stone:#E5E7EB;--anthracite:#1F2937;--text-secondary:#6B7280;--success:#10B981;--danger:#EF4444;--font-headline:'Inter',sans-serif;--font-mono:'JetBrains Mono',monospace}
        body{font-family:var(--font-headline);background:var(--surface);color:var(--anthracite)}
        .container{max-width:1280px;margin:0 auto;padding:0 24px}
        
        /* Header */
        .header{background:var(--navy);color:white;position:sticky;top:0;z-index:1000}
        .header-main{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
        .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:white}
        .logo-icon{width:44px;height:44px;background:var(--cyan);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:24px}
        .logo-text{font-weight:800;font-size:20px}.logo-text span{color:var(--cyan)}
        .nav-links{display:flex;list-style:none;gap:8px}
        .nav-links a{color:rgba(255,255,255,0.85);text-decoration:none;font-size:14px;font-weight:500;padding:10px 16px;border-radius:6px;transition:all 0.2s}
        .nav-links a:hover{color:var(--cyan);background:rgba(0,242,255,0.1)}
        .nav-links a.active{background:var(--cyan);color:var(--navy)}
        .mobile-menu-btn{display:none;background:none;border:none;color:white;font-size:28px;cursor:pointer;padding:8px}
        
        /* Mobile Menu */
        .mobile-menu{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--navy);z-index:999;display:flex;flex-direction:column;padding:80px 24px 24px;transform:translateX(100%);transition:transform 0.3s}
        .mobile-menu.active{transform:translateX(0)}
        .mobile-menu a{color:white;text-decoration:none;font-size:20px;font-weight:600;padding:16px 0;border-bottom:1px solid rgba(255,255,255,0.1)}
        .mobile-menu a:hover{color:var(--cyan)}
        .mobile-menu-close{position:absolute;top:20px;right:20px;background:none;border:none;color:white;font-size:32px;cursor:pointer}
        
        /* Page Header */
        .page-header{background:linear-gradient(135deg,var(--navy),var(--navy-dark));color:white;padding:48px 0}
        .page-header h1{font-size:36px;margin-bottom:8px}
        .page-subtitle{font-family:var(--font-mono);font-size:14px;color:rgba(255,255,255,0.7)}
        .data-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(0,242,255,0.15);border:1px solid var(--cyan);padding:6px 12px;border-radius:20px;font-family:var(--font-mono);font-size:11px;color:var(--cyan);margin-top:16px}
        .data-badge::before{content:"";width:8px;height:8px;background:var(--cyan);border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        
        /* KPI Cards */
        .kpi-section{padding:32px 0;background:white;border-bottom:1px solid var(--stone)}
        .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
        .kpi-card{background:var(--surface);border-radius:12px;padding:24px;border:1px solid var(--stone)}
        .kpi-label{font-family:var(--font-mono);font-size:11px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px}
        .kpi-value{font-family:var(--font-mono);font-size:32px;font-weight:800;color:var(--navy)}
        .kpi-change{display:inline-flex;align-items:center;gap:4px;font-family:var(--font-mono);font-size:12px;margin-top:8px;padding:4px 8px;border-radius:4px}
        .kpi-change.positive{background:rgba(16,185,129,0.1);color:var(--success)}
        .kpi-change.negative{background:rgba(239,68,68,0.1);color:var(--danger)}
        
        /* Charts */
        .charts-section{padding:40px 0}
        .charts-grid{display:grid;grid-template-columns:2fr 1fr;gap:24px}
        .chart-card{background:white;border-radius:12px;border:1px solid var(--stone);overflow:hidden}
        .chart-header{padding:20px;border-bottom:1px solid var(--stone)}
        .chart-title{font-size:16px;font-weight:700;color:var(--navy)}
        .chart-body{padding:20px;height:300px}
        
        /* Tables */
        .tables-section{padding:0 0 60px}
        .tables-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
        .table-card{background:white;border-radius:12px;border:1px solid var(--stone);overflow:hidden}
        .table-header{padding:20px;border-bottom:1px solid var(--stone);display:flex;justify-content:space-between;align-items:center}
        .table-title{font-size:16px;font-weight:700;color:var(--navy)}
        table{width:100%;border-collapse:collapse}
        th,td{padding:12px 20px;text-align:left;border-bottom:1px solid var(--stone)}
        th{font-family:var(--font-mono);font-size:11px;color:var(--text-secondary);text-transform:uppercase;background:var(--surface)}
        td{font-size:14px; vertical-align: middle;}
        .rank{font-family:var(--font-mono);font-weight:700;color:var(--cyan)}
        .trend-up{color:var(--success)}
        .trend-down{color:var(--danger)}
        
        /* Footer */
        .footer{background:var(--navy-dark);color:white;padding:40px 0 24px}
        .footer-content{display:flex;justify-content:space-between;align-items:center}
        .footer-links{display:flex;gap:24px}
        .footer-links a{font-family:var(--font-mono);font-size:12px;color:rgba(255,255,255,0.5);text-decoration:none}
        .footer-links a:hover{color:var(--cyan)}
        .footer-copyright{font-family:var(--font-mono);font-size:12px;color:rgba(255,255,255,0.5)}
        
        /* Responsive */
        @media(max-width:1024px){
            .nav-links{display:none}
            .mobile-menu-btn{display:block}
            .kpi-grid{grid-template-columns:repeat(2,1fr)}
            .charts-grid,.tables-grid{grid-template-columns:1fr}
        }
        @media(max-width:768px){
            .kpi-grid{grid-template-columns:1fr}
            .page-header h1{font-size:28px}
            .footer-content{flex-direction:column;gap:16px;text-align:center}
        }
    </style>
</head>
<body>
    <div class="mobile-menu" id="mobile-menu">
        <button class="mobile-menu-close" onclick="toggleMobileMenu()">‚úï</button>
        <a href="index.html">üè† Home</a>
        <a href="dashboard.html">üìä Dashboard</a>
        <a href="fahrzeuge.html">üîã Fahrzeuge</a>
        <a href="news.html">üì∞ News</a>
        <a href="laden.html">‚ö° Laden</a>
        <a href="ratgeber.html">üìã Ratgeber</a>
        <a href="reichweite.html">üìè Analyse</a>
    </div>

    <header class="header"><div class="container"><div class="header-main">
        <a href="index.html" class="logo"><div class="logo-icon">‚ö°</div><div class="logo-text">EV Technical <span>Insights</span></div></a>
        <ul class="nav-links">
            <li><a href="dashboard.html" class="active">üìä Dashboard</a></li>
            <li><a href="fahrzeuge.html">üîã Fahrzeuge</a></li>
            <li><a href="news.html">üì∞ News</a></li>
            <li><a href="laden.html">‚ö° Laden</a></li>
            <li><a href="ratgeber.html">üìã Ratgeber</a></li>
            <li><a href="reichweite.html">üìè Analyse</a></li>
        </ul>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
    </div></div></header>

    <section class="page-header"><div class="container">
        <h1>üìä Markt-Dashboard</h1>
        <p class="page-subtitle">Elektromobilit√§t Schweiz - Live-Daten & Statistiken</p>
        <div class="data-badge" id="update-badge">Daten werden geladen...</div>
    </div></section>

    <section class="kpi-section"><div class="container">
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">BEV-Marktanteil</div>
                <div class="kpi-value" id="kpi-bev-share">--</div>
                <div class="kpi-change positive" id="kpi-bev-change">--</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">BEV Neuzulassungen</div>
                <div class="kpi-value" id="kpi-bev-total">--</div>
                <div class="kpi-change positive" id="kpi-bev-total-change">--</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Total Neuzulassungen</div>
                <div class="kpi-value" id="kpi-total">--</div>
                <div class="kpi-change positive" id="kpi-total-change">--</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Elektrifiziert (BEV+PHEV)</div>
                <div class="kpi-value" id="kpi-electrified">--</div>
                <div class="kpi-change positive" id="kpi-electrified-change">--</div>
            </div>
        </div>
    </div></section>

    <section class="charts-section"><div class="container">
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header"><h3 class="chart-title">üìà Monatliche Entwicklung 2024</h3></div>
                <div class="chart-body"><canvas id="chart-monthly"></canvas></div>
            </div>
            <div class="chart-card">
                <div class="chart-header"><h3 class="chart-title">ü•ß Marktanteile aktueller Monat</h3></div>
                <div class="chart-body"><canvas id="chart-share"></canvas></div>
            </div>
        </div>
    </div></section>

    <section class="tables-section"><div class="container">
        <div class="tables-grid">
            <div class="table-card">
                <div class="table-header"><h3 class="table-title">üèÜ Top 5 Marken (BEV)</h3></div>
                <table id="table-brands">
                    <thead><tr><th>Rang</th><th>Marke</th><th>Verk√§ufe</th><th>Trend</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="table-card">
                <div class="table-header"><h3 class="table-title">üöó Top 5 Modelle (BEV)</h3></div>
                <table id="table-models">
                    <thead><tr><th>Rang</th><th>Modell</th><th>Verk√§ufe</th><th>Anteil</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div></section>

    <footer class="footer"><div class="container"><div class="footer-content">
        <a href="index.html" class="logo"><div class="logo-icon">‚ö°</div><div class="logo-text">EV Technical <span>Insights</span></div></a>
        <div class="footer-links">
            <a href="impressum.html">Impressum</a>
            <a href="datenschutz.html">Datenschutz</a>
        </div>
        <p class="footer-copyright">¬© 2025 EV Technical Insights</p>
    </div></div></footer>

    <script>
        // Mobile Menu
        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('active');
            document.body.style.overflow = document.getElementById('mobile-menu').classList.contains('active') ? 'hidden' : '';
        }

        // Data URLs (Auf ./data/ ge√§ndert f√ºr bessere Performance & relative Pfade)
// Wir nutzen wieder den vollen Pfad, um sicherzugehen
const DATA_BASE = 'https://raw.githubusercontent.com/emirdurut-maker/ev-portal-schweiz/main/data/';        const URLS = {
            markt: DATA_BASE + 'markt.csv',
            marken: DATA_BASE + 'marken.csv',
            modelle: DATA_BASE + 'modelle.csv'
        };

        let chartMonthly, chartShare;

        // Helfer: Bild-URL generieren (Tesla Model 3 -> tesla-model-3.jpg)
        function getCarImage(marke, modell) {
            const cleanName = (marke + " " + modell).toLowerCase()
                .replace(/√§/g, 'ae').replace(/√∂/g, 'oe').replace(/√º/g, 'ue')
                .replace(/[^a-z0-9 ]/g, '') // Sonderzeichen weg
                .trim().replace(/\s+/g, '-'); // Leerzeichen zu Bindestrich
            return `./images/${cleanName}.jpg`;
        }

        // Load CSV
        async function loadCSV(url) {
            return new Promise((resolve, reject) => {
                Papa.parse(url, {
                    download: true, header: true, dynamicTyping: true, skipEmptyLines: true,
                    complete: r => resolve(r.data),
                    error: e => reject(e)
                });
            });
        }

        // Initialize
        async function init() {
            try {
                const [markt, marken, modelle] = await Promise.all([
                    loadCSV(URLS.markt),
                    loadCSV(URLS.marken),
                    loadCSV(URLS.modelle)
                ]);

                updateKPIs(markt);
                renderMonthlyChart(markt);
                renderShareChart(markt);
                renderBrandsTable(marken);
                renderModelsTable(modelle); // Jetzt mit Bildern!

                const latest = markt[markt.length - 1];
                document.getElementById('update-badge').textContent = `Stand: ${latest.monat} ${latest.jahr}`;

            } catch (e) {
                console.error('Fehler:', e);
                document.getElementById('update-badge').textContent = '‚ö†Ô∏è Daten laden...';
                // Fallback, falls lokale Pfade scheitern (z.B. bei lokalem √ñffnen ohne Server)
                console.log("Hinweis: √ñffne die Seite √ºber einen lokalen Server oder GitHub Pages, damit CSVs geladen werden k√∂nnen.");
            }
        }

        // Update KPIs
        function updateKPIs(data) {
            const latest = data[data.length - 1];
            const prev = data[data.length - 2];

            document.getElementById('kpi-bev-share').textContent = latest.bev_anteil + '%';
            document.getElementById('kpi-bev-total').textContent = latest.bev.toLocaleString('de-CH');
            document.getElementById('kpi-total').textContent = latest.total.toLocaleString('de-CH');
            
            const electrified = latest.bev_anteil + latest.phev_anteil;
            document.getElementById('kpi-electrified').textContent = electrified.toFixed(1) + '%';

            // Changes
            const bevChange = (latest.bev_anteil - prev.bev_anteil).toFixed(1);
            setChange('kpi-bev-change', bevChange, '%');
            
            const bevTotalChange = (((latest.bev - prev.bev) / prev.bev) * 100).toFixed(0);
            setChange('kpi-bev-total-change', bevTotalChange, '%');
            
            const totalChange = (((latest.total - prev.total) / prev.total) * 100).toFixed(0);
            setChange('kpi-total-change', totalChange, '%');
            
            const prevElectrified = prev.bev_anteil + prev.phev_anteil;
            const electrifiedChange = (electrified - prevElectrified).toFixed(1);
            setChange('kpi-electrified-change', electrifiedChange, '%');
        }

        function setChange(id, value, suffix) {
            const el = document.getElementById(id);
            const isPositive = parseFloat(value) >= 0;
            el.className = 'kpi-change ' + (isPositive ? 'positive' : 'negative');
            el.textContent = (isPositive ? '+' : '') + value + suffix;
        }

        // Monthly Chart
        function renderMonthlyChart(data) {
            const ctx = document.getElementById('chart-monthly').getContext('2d');
            chartMonthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.monat.toString().slice(0, 3)),
                    datasets: [
                        { label: 'BEV', data: data.map(d => d.bev), backgroundColor: '#00F2FF' },
                        { label: 'PHEV', data: data.map(d => d.phev), backgroundColor: '#002B5B' },
                        { label: 'Verbrenner', data: data.map(d => d.ice), backgroundColor: '#E5E7EB' }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { stacked: true }, y: { stacked: true } },
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        // Share Chart
        function renderShareChart(data) {
            const latest = data[data.length - 1];
            const ctx = document.getElementById('chart-share').getContext('2d');
            chartShare = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['BEV', 'PHEV', 'Hybrid', 'Verbrenner'],
                    datasets: [{
                        data: [latest.bev_anteil, latest.phev_anteil, latest.hev_anteil, latest.ice_anteil],
                        backgroundColor: ['#00F2FF', '#002B5B', '#6B7280', '#E5E7EB']
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        // Brands Table
        function renderBrandsTable(data) {
            const tbody = document.querySelector('#table-brands tbody');
            tbody.innerHTML = data.slice(0, 5).map(d => `
                <tr>
                    <td class="rank">#${d.rang}</td>
                    <td><strong>${d.marke}</strong></td>
                    <td>${d.verkaeufe.toLocaleString('de-CH')}</td>
                    <td class="${d.trend >= 0 ? 'trend-up' : 'trend-down'}">${d.trend >= 0 ? '+' : ''}${d.trend}%</td>
                </tr>
            `).join('');
        }

        // Models Table MIT BILDERN
        function renderModelsTable(data) {
            const tbody = document.querySelector('#table-models tbody');
            tbody.innerHTML = data.slice(0, 5).map(d => {
                const imgPath = getCarImage(d.marke, d.modell);
                return `
                <tr>
                    <td class="rank">#${d.rang}</td>
                    <td>
                        <div style="display:flex; align-items:center;">
                            <img src="${imgPath}" 
                                 onerror="this.style.display='none'" 
                                 style="width:50px; height:30px; object-fit:cover; border-radius:4px; margin-right:12px; border:1px solid #eee; background:#fff;">
                            <strong>${d.marke} ${d.modell}</strong>
                        </div>
                    </td>
                    <td>${d.verkaeufe.toLocaleString('de-CH')}</td>
                    <td>${d.anteil}%</td>
                </tr>
            `}).join('');
        }

        init();
    </script>
</body>
</html>
