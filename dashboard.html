<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | EV Technical Insights</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--navy:#002B5B;--navy-dark:#001a38;--cyan:#00F2FF;--cyan-dim:rgba(0,242,255,0.15);--surface:#F9FAFB;--stone:#E5E7EB;--anthracite:#1F2937;--text-secondary:#6B7280;--success:#10B981;--success-dim:rgba(16,185,129,0.1);--danger:#EF4444;--danger-dim:rgba(239,68,68,0.1);--font-headline:'Inter',sans-serif;--font-mono:'JetBrains Mono',monospace}
        body{font-family:var(--font-headline);background:var(--surface);color:var(--anthracite)}
        .container{max-width:1280px;margin:0 auto;padding:0 24px}
        .header{background:var(--navy);color:white;position:sticky;top:0;z-index:1000}
        .header-main{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
        .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:white}
        .logo-icon{width:44px;height:44px;background:var(--cyan);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:24px}
        .logo-text{font-weight:800;font-size:20px}.logo-text span{color:var(--cyan)}
        .nav-links{display:flex;list-style:none;gap:8px}
        .nav-links a{color:rgba(255,255,255,0.85);text-decoration:none;font-size:14px;font-weight:500;padding:10px 16px;border-radius:6px;transition:all 0.2s}
        .nav-links a:hover{color:var(--cyan);background:rgba(0,242,255,0.1)}
        .nav-links a.active{background:var(--cyan);color:var(--navy)}
        .page-header{background:linear-gradient(135deg,var(--navy),var(--navy-dark));color:white;padding:48px 0}
        .page-header-content{display:flex;justify-content:space-between;align-items:center}
        .page-header h1{font-size:36px;margin-bottom:8px}
        .page-subtitle{font-family:var(--font-mono);font-size:14px;color:rgba(255,255,255,0.7)}
        .live-indicator{display:flex;align-items:center;gap:12px;background:var(--cyan-dim);border:1px solid var(--cyan);padding:12px 20px;border-radius:8px}
        .live-dot{width:10px;height:10px;background:var(--cyan);border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .live-text{font-family:var(--font-mono);font-size:13px;color:var(--cyan)}
        .live-time{font-family:var(--font-mono);font-size:12px;color:rgba(255,255,255,0.6)}
        .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:-40px;position:relative;z-index:10}
        .kpi-card{background:white;border-radius:12px;padding:24px;border:1px solid var(--stone);box-shadow:0 4px 20px rgba(0,43,91,0.08)}
        .kpi-header{display:flex;justify-content:space-between;margin-bottom:16px}
        .kpi-icon{width:40px;height:40px;background:var(--cyan-dim);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
        .kpi-trend{font-family:var(--font-mono);font-size:12px;padding:4px 8px;border-radius:4px}
        .kpi-trend.up{background:var(--success-dim);color:var(--success)}
        .kpi-trend.down{background:var(--danger-dim);color:var(--danger)}
        .kpi-value{font-size:32px;font-weight:800;color:var(--navy);margin-bottom:8px}
        .kpi-value .unit{font-size:18px;color:var(--cyan)}
        .kpi-label{font-family:var(--font-mono);font-size:12px;color:var(--text-secondary);text-transform:uppercase}
        .dashboard-grid{display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-top:40px;margin-bottom:60px}
        .dashboard-card{background:white;border-radius:12px;border:1px solid var(--stone);overflow:hidden}
        .card-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--stone)}
        .card-title{font-size:18px;font-weight:700;display:flex;align-items:center;gap:10px}
        .card-body{padding:24px}
        .chart-container{height:300px}
        .market-share-container{display:flex;align-items:center;gap:32px}
        .donut-chart{width:180px;height:180px;position:relative}
        .donut-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
        .donut-value{font-size:28px;font-weight:800;color:var(--navy)}
        .donut-label{font-family:var(--font-mono);font-size:10px;color:var(--text-secondary);text-transform:uppercase}
        .market-legend{flex:1}
        .legend-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--stone)}
        .legend-item:last-child{border-bottom:none}
        .legend-label{display:flex;align-items:center;gap:10px}
        .legend-color{width:12px;height:12px;border-radius:3px}
        .legend-text{font-size:14px;font-weight:500}
        .legend-value{font-family:var(--font-mono);font-size:14px;font-weight:500;color:var(--navy)}
        .data-table{width:100%;border-collapse:collapse}
        .data-table th{font-family:var(--font-mono);font-size:11px;text-transform:uppercase;color:var(--text-secondary);text-align:left;padding:12px 16px;background:var(--surface);border-bottom:2px solid var(--navy)}
        .data-table td{font-size:14px;padding:14px 16px;border-bottom:1px solid var(--stone)}
        .data-table tr:hover td{background:var(--cyan-dim)}
        .table-rank{font-family:var(--font-mono);font-weight:600;color:var(--navy);width:40px}
        .table-brand{display:flex;align-items:center;gap:12px}
        .brand-logo{width:32px;height:32px;background:var(--navy);border-radius:6px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:12px}
        .table-value{font-family:var(--font-mono)}
        .table-change{font-family:var(--font-mono);font-size:12px;padding:3px 8px;border-radius:4px}
        .table-change.positive{background:var(--success-dim);color:var(--success)}
        .table-change.negative{background:var(--danger-dim);color:var(--danger)}
        .table-bar{width:80px;height:6px;background:var(--stone);border-radius:3px;overflow:hidden}
        .table-bar-fill{height:100%;background:linear-gradient(90deg,var(--navy),var(--cyan));border-radius:3px}
        .data-source{font-family:var(--font-mono);font-size:11px;color:var(--text-secondary);padding:16px 24px;border-top:1px solid var(--stone);display:flex;justify-content:space-between}
        .data-source a{color:var(--cyan);text-decoration:none}
        .footer{background:var(--navy-dark);color:white;padding:40px 0 24px}
        .footer-content{display:flex;justify-content:space-between;align-items:center}
        .footer-copyright{font-family:var(--font-mono);font-size:12px;color:rgba(255,255,255,0.5)}
        @media(max-width:1024px){.nav-links{display:none}.kpi-grid{grid-template-columns:repeat(2,1fr)}.dashboard-grid{grid-template-columns:1fr}}
        @media(max-width:768px){.kpi-grid{grid-template-columns:1fr;margin-top:-20px}.page-header-content{flex-direction:column;gap:20px;align-items:flex-start}.market-share-container{flex-direction:column}}
    </style>
</head>
<body>
    <header class="header"><div class="container"><div class="header-main">
        <a href="index.html" class="logo"><div class="logo-icon">‚ö°</div><div class="logo-text">EV Technical <span>Insights</span></div></a>
        <ul class="nav-links">
            <li><a href="dashboard.html" class="active">üìä Dashboard</a></li>
            <li><a href="fahrzeuge.html">üîã Fahrzeuge</a></li>
            <li><a href="news.html">üì∞ News</a></li>
            <li><a href="laden.html">‚ö° Laden</a></li>
            <li><a href="ratgeber.html">üìã Ratgeber</a></li>
            <li><a href="service.html">üîß Service</a></li>
            <li><a href="reichweite.html">üìè Reichweite</a></li>
        </ul>
    </div></div></header>

    <section class="page-header"><div class="container"><div class="page-header-content">
        <div><h1>üìä Markt-Dashboard</h1><p class="page-subtitle">Echtzeit-Daten zur Elektromobilit√§t in der Schweiz</p></div>
        <div class="live-indicator"><div class="live-dot"></div><div><div class="live-text">CSV DATEN</div><div class="live-time" id="last-update">Wird geladen...</div></div></div>
    </div></div></section>

    <main><div class="container">
        <div class="kpi-grid">
            <div class="kpi-card"><div class="kpi-header"><div class="kpi-icon">üìà</div><span class="kpi-trend up" id="kpi1-trend">--</span></div><div class="kpi-value" id="kpi1-value">--<span class="unit">%</span></div><div class="kpi-label">BEV-Marktanteil</div></div>
            <div class="kpi-card"><div class="kpi-header"><div class="kpi-icon">üöó</div><span class="kpi-trend up" id="kpi2-trend">--</span></div><div class="kpi-value" id="kpi2-value">--</div><div class="kpi-label">BEV Neuzulassungen</div></div>
            <div class="kpi-card"><div class="kpi-header"><div class="kpi-icon">üìä</div><span class="kpi-trend up" id="kpi3-trend">--</span></div><div class="kpi-value" id="kpi3-value">--</div><div class="kpi-label">Total Neuzulassungen</div></div>
            <div class="kpi-card"><div class="kpi-header"><div class="kpi-icon">üîå</div><span class="kpi-trend up" id="kpi4-trend">--</span></div><div class="kpi-value" id="kpi4-value">--<span class="unit">%</span></div><div class="kpi-label">Elektrifiziert</div></div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header"><h3 class="card-title">üìä Neuzulassungen 2024</h3></div>
                <div class="card-body"><div class="chart-container"><canvas id="mainChart"></canvas></div></div>
                <div class="data-source"><span>Quelle: <a href="https://www.auto.swiss" target="_blank">auto.swiss</a></span><span>2024</span></div>
            </div>

            <div class="dashboard-card">
                <div class="card-header"><h3 class="card-title">ü•ß Marktanteile Dez 2024</h3></div>
                <div class="card-body">
                    <div class="market-share-container">
                        <div class="donut-chart"><canvas id="donutChart"></canvas><div class="donut-center"><div class="donut-value" id="donut-value">--%</div><div class="donut-label">Elektrifiziert</div></div></div>
                        <div class="market-legend">
                            <div class="legend-item"><div class="legend-label"><div class="legend-color" style="background:#00F2FF"></div><span class="legend-text">BEV</span></div><span class="legend-value" id="leg-bev">--%</span></div>
                            <div class="legend-item"><div class="legend-label"><div class="legend-color" style="background:#002B5B"></div><span class="legend-text">PHEV</span></div><span class="legend-value" id="leg-phev">--%</span></div>
                            <div class="legend-item"><div class="legend-label"><div class="legend-color" style="background:#6B7280"></div><span class="legend-text">Hybrid</span></div><span class="legend-value" id="leg-hev">--%</span></div>
                            <div class="legend-item"><div class="legend-label"><div class="legend-color" style="background:#E5E7EB"></div><span class="legend-text">Verbrenner</span></div><span class="legend-value" id="leg-ice">--%</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header"><h3 class="card-title">üèÜ Top BEV-Marken Dez 2024</h3></div>
                <div class="card-body" style="padding:0"><table class="data-table"><thead><tr><th>#</th><th>Marke</th><th>Verk√§ufe</th><th>Trend</th><th></th></tr></thead><tbody id="brands-table"></tbody></table></div>
            </div>

            <div class="dashboard-card">
                <div class="card-header"><h3 class="card-title">üöó Top BEV-Modelle Dez 2024</h3></div>
                <div class="card-body" style="padding:0"><table class="data-table"><thead><tr><th>#</th><th>Modell</th><th>Verk√§ufe</th><th></th></tr></thead><tbody id="models-table"></tbody></table></div>
            </div>
        </div>
    </div></main>

    <footer class="footer"><div class="container"><div class="footer-content">
        <a href="index.html" class="logo"><div class="logo-icon">‚ö°</div><div class="logo-text">EV Technical <span>Insights</span></div></a>
        <p class="footer-copyright">¬© 2025 EV Technical Insights</p>
    </div></div></footer>

    <script>
    const DATA_URLS = {
        markt: 'https://raw.githubusercontent.com/emirdurut-maker/ev-portal-schweiz/main/data/markt.csv',
        marken: 'https://raw.githubusercontent.com/emirdurut-maker/ev-portal-schweiz/main/data/marken.csv',
        modelle: 'https://raw.githubusercontent.com/emirdurut-maker/ev-portal-schweiz/main/data/modelle.csv'
    };
    
    let marktData = [], markenData = [], modelleData = [];
    let mainChart, donutChart;
    const monthNames = ['Jan','Feb','M√§r','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'];
    
    async function loadCSV(url) {
        return new Promise((resolve, reject) => {
            Papa.parse(url, {
                download: true, header: true, dynamicTyping: true, skipEmptyLines: true,
                complete: r => resolve(r.data),
                error: e => reject(e)
            });
        });
    }
    
    async function init() {
        try {
            [marktData, markenData, modelleData] = await Promise.all([
                loadCSV(DATA_URLS.markt),
                loadCSV(DATA_URLS.marken),
                loadCSV(DATA_URLS.modelle)
            ]);
            document.getElementById('last-update').textContent = 'Aktualisiert: ' + new Date().toLocaleDateString('de-CH');
            updateKPIs();
            updateMainChart();
            updateDonutChart();
            updateBrandsTable();
            updateModelsTable();
        } catch(e) {
            console.error('Fehler:', e);
            document.getElementById('last-update').textContent = 'Fehler beim Laden';
        }
    }
    
    function updateKPIs() {
        const latest = marktData[marktData.length - 1];
        const prev = marktData[marktData.length - 2];
        
        document.getElementById('kpi1-value').innerHTML = latest.bev_anteil.toFixed(1) + '<span class="unit">%</span>';
        const diff1 = (latest.bev_anteil - prev.bev_anteil).toFixed(1);
        document.getElementById('kpi1-trend').textContent = (diff1 > 0 ? '‚Üë +' : '‚Üì ') + diff1 + '%';
        document.getElementById('kpi1-trend').className = 'kpi-trend ' + (diff1 > 0 ? 'up' : 'down');
        
        document.getElementById('kpi2-value').textContent = latest.bev.toLocaleString('de-CH');
        const diff2 = ((latest.bev - prev.bev) / prev.bev * 100).toFixed(0);
        document.getElementById('kpi2-trend').textContent = (diff2 > 0 ? '‚Üë +' : '‚Üì ') + diff2 + '%';
        document.getElementById('kpi2-trend').className = 'kpi-trend ' + (diff2 > 0 ? 'up' : 'down');
        
        document.getElementById('kpi3-value').textContent = latest.total.toLocaleString('de-CH');
        const diff3 = ((latest.total - prev.total) / prev.total * 100).toFixed(0);
        document.getElementById('kpi3-trend').textContent = (diff3 > 0 ? '‚Üë +' : '‚Üì ') + diff3 + '%';
        document.getElementById('kpi3-trend').className = 'kpi-trend ' + (diff3 > 0 ? 'up' : 'down');
        
        const elec = latest.bev_anteil + latest.phev_anteil;
        const elecPrev = prev.bev_anteil + prev.phev_anteil;
        document.getElementById('kpi4-value').innerHTML = elec.toFixed(1) + '<span class="unit">%</span>';
        const diff4 = (elec - elecPrev).toFixed(1);
        document.getElementById('kpi4-trend').textContent = (diff4 > 0 ? '‚Üë +' : '‚Üì ') + diff4 + '%';
        document.getElementById('kpi4-trend').className = 'kpi-trend ' + (diff4 > 0 ? 'up' : 'down');
    }
    
    function updateMainChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (mainChart) mainChart.destroy();
        mainChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: marktData.map(d => monthNames[d.monat - 1]),
                datasets: [
                    { label: 'BEV', data: marktData.map(d => d.bev), backgroundColor: '#00F2FF', borderRadius: 4 },
                    { label: 'PHEV', data: marktData.map(d => d.phev), backgroundColor: '#002B5B', borderRadius: 4 },
                    { label: 'Verbrenner', data: marktData.map(d => d.ice), backgroundColor: '#E5E7EB', borderRadius: 4 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'top', align: 'end' } },
                scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }
            }
        });
    }
    
    function updateDonutChart() {
        const latest = marktData[marktData.length - 1];
        const ctx = document.getElementById('donutChart').getContext('2d');
        document.getElementById('leg-bev').textContent = latest.bev_anteil.toFixed(1) + '%';
        document.getElementById('leg-phev').textContent = latest.phev_anteil.toFixed(1) + '%';
        document.getElementById('leg-hev').textContent = latest.hev_anteil.toFixed(1) + '%';
        document.getElementById('leg-ice').textContent = latest.ice_anteil.toFixed(1) + '%';
        document.getElementById('donut-value').textContent = (latest.bev_anteil + latest.phev_anteil).toFixed(1) + '%';
        if (donutChart) donutChart.destroy();
        donutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['BEV', 'PHEV', 'Hybrid', 'Verbrenner'],
                datasets: [{ data: [latest.bev_anteil, latest.phev_anteil, latest.hev_anteil, latest.ice_anteil], backgroundColor: ['#00F2FF', '#002B5B', '#6B7280', '#E5E7EB'], borderWidth: 0, cutout: '70%' }]
            },
            options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } }
        });
    }
    
    function updateBrandsTable() {
        const html = markenData.slice(0, 5).map(m => `
            <tr>
                <td class="table-rank">${m.rang}</td>
                <td><div class="table-brand"><div class="brand-logo">${m.marke.charAt(0)}</div><span>${m.marke}</span></div></td>
                <td class="table-value">${m.verkaeufe.toLocaleString('de-CH')}</td>
                <td><span class="table-change ${m.trend > 0 ? 'positive' : 'negative'}">${m.trend > 0 ? '+' : ''}${m.trend}%</span></td>
                <td><div class="table-bar"><div class="table-bar-fill" style="width:${m.anteil * 4}%"></div></div></td>
            </tr>
        `).join('');
        document.getElementById('brands-table').innerHTML = html;
    }
    
    function updateModelsTable() {
        const html = modelleData.slice(0, 5).map(m => `
            <tr>
                <td class="table-rank">${m.rang}</td>
                <td><div class="table-brand"><div class="brand-logo">${m.marke.charAt(0)}</div><span>${m.marke} ${m.modell}</span></div></td>
                <td class="table-value">${m.verkaeufe.toLocaleString('de-CH')}</td>
                <td><div class="table-bar"><div class="table-bar-fill" style="width:${m.anteil * 6}%"></div></div></td>
            </tr>
        `).join('');
        document.getElementById('models-table').innerHTML = html;
    }
    
    Chart.defaults.font.family = "'Inter', sans-serif";
    Chart.defaults.color = '#6B7280';
    init();
    </script>
</body>
</html>
